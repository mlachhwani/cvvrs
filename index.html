<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CVVRS MONITORING SYSTEM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glossy-card { background: white; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-top: 6px solid; }
        .mandatory { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        .btn-active { transform: scale(0.98); opacity: 0.9; }
    </style>
</head>
<body class="bg-slate-100 font-sans pb-10">

    <script>
        // YAHAN APNA DEPLOYED WEB APP URL PASTE KAREIN
        const scriptURL = 'https://script.google.com/macros/s/AKfycbztTiIcaJMtCzpzDPzIwsXhf6Mfw1sm7GO6oPWb7KHS6w30br3AP_aQSJSfWEN-xjV1/exec';
    </script>

    <div class="bg-blue-900 p-6 text-white text-center rounded-b-[40px] shadow-lg">
        <h1 class="text-xl font-black italic tracking-tighter">CVVRS ANALYSIS MASTER</h1>
        <p class="text-[9px] font-bold opacity-60 tracking-[3px] uppercase mt-1">Raipur Division | Electrical OP</p>
    </div>

    <div class="max-w-md mx-auto p-4 space-y-6">

        <div class="glossy-card border-blue-900 p-6 space-y-4">
            <input type="text" id="cli_name" placeholder="Analysed By (CLI Name)" class="w-full p-4 bg-gray-50 rounded-2xl border-2 font-bold outline-none focus:border-blue-900">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="train_no" placeholder="Train No" class="p-4 bg-gray-50 rounded-2xl border-2 font-bold">
                <input type="text" id="loco_no" placeholder="Loco No" class="p-4 bg-gray-50 rounded-2xl border-2 font-bold">
            </div>
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="section_from" placeholder="From Station" class="p-4 bg-gray-50 rounded-2xl border-2 font-bold text-xs">
                <input type="text" id="section_to" placeholder="To Station" class="p-4 bg-gray-50 rounded-2xl border-2 font-bold text-xs">
            </div>
        </div>

        <div class="space-y-4">
            <div class="glossy-card border-blue-600 p-5">
                <label class="text-[10px] font-black text-blue-900 uppercase mb-1 block tracking-wider">LP CMS ID (Master List)</label>
                <input type="text" id="lp_id" onchange="lookupCrew('lp')" placeholder="Enter ID" class="w-full p-4 bg-blue-50 border-2 border-blue-100 rounded-2xl font-black text-xl uppercase outline-none">
                <div id="lp_info" class="hidden mt-3 p-4 bg-blue-900 rounded-2xl text-white space-y-1">
                    <p id="lp_name_val" class="font-black text-lg">---</p>
                    <div class="flex justify-between text-[10px] font-bold opacity-70">
                        <span>Desig: <b id="lp_dsg_val">--</b></span>
                        <span>CLI: <b id="lp_cli_val">--</b></span>
                    </div>
                </div>
            </div>

            <div class="glossy-card border-orange-500 p-5">
                <label class="text-[10px] font-black text-orange-900 uppercase mb-1 block tracking-wider">ALP CMS ID (Master List)</label>
                <input type="text" id="alp_id" onchange="lookupCrew('alp')" placeholder="Enter ID" class="w-full p-4 bg-orange-50 border-2 border-orange-100 rounded-2xl font-black text-xl uppercase outline-none">
                <div id="alp_info" class="hidden mt-3 p-4 bg-orange-600 rounded-2xl text-white space-y-1">
                    <p id="alp_name_val" class="font-black text-lg">---</p>
                    <div class="flex justify-between text-[10px] font-bold opacity-70">
                        <span>Desig: <b id="alp_dsg_val">--</b></span>
                        <span>CLI: <b id="alp_cli_val">--</b></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="glossy-card border-gray-800 overflow-hidden">
            <div class="bg-gray-800 p-3 text-center text-white text-[10px] font-black uppercase italic tracking-widest">Crew Safety Checklist (32 Points)</div>
            <div id="points_container" class="p-4 space-y-6">
                </div>
        </div>

        <div class="glossy-card border-red-600 p-6">
            <h3 class="text-center font-black text-red-600 text-[10px] mb-3 uppercase">Any Other Abnormality</h3>
            <textarea id="abnormality" oninput="checkAbn(this.value)" class="w-full p-4 bg-gray-50 rounded-2xl border-2 font-bold text-sm outline-none" placeholder="Details..."></textarea>
            <div id="photo_req" class="hidden mt-3 p-4 bg-red-100 border-2 border-dashed border-red-400 rounded-2xl text-center">
                <p class="text-[10px] font-black text-red-600 uppercase mb-2">üìé Photo Mandatory</p>
                <input type="file" id="evidence_file" class="text-xs font-bold">
            </div>
        </div>

        <div class="pt-4 space-y-4">
            <button id="submit_btn" onclick="submitToDrive()" class="w-full bg-blue-900 text-white p-6 rounded-[30px] font-black text-xl shadow-xl active:scale-95 transition-all">
                SUBMIT TO DRIVE
            </button>
            
            <button id="download_btn" onclick="alert('PDF Generated')" class="hidden w-full bg-green-600 text-white p-6 rounded-[30px] font-black text-xl shadow-xl animate-bounce">
                üìÑ DOWNLOAD REPORT
            </button>
        </div>

    </div>

    <script>
        // 1. Point Generation (LP & ALP 16 Each)
        const categories = ["During CTO", "On Run", "At Halts", "CHO"];
        const lp_points = ["Logbook & BPC", "Safety Items", "Energy Meter", "BFT/BPT", "Signal Calling", "Mobile Phone", "Micro Sleep", "Signal Exchange", "Neutral Section", "Alertness", "A9/SA9", "Reverser", "Headlight", "Undergear", "Whistle", "Packing"];
        const alp_points = ["RS Valve", "Safety Items", "Energy Meter", "Danger Signal", "Signal Calling", "Mobile Phone", "Micro Sleep", "Signal Exchange", "Curve/Caution", "Alertness", "A9/SA9", "Reverser", "Headlight", "Undergear", "Signal Exch", "Packing"];

        const container = document.getElementById('points_container');
        for(let i=0; i<16; i++) {
            container.innerHTML += `
                <div class="border-b pb-4">
                    <p class="text-[9px] font-black text-gray-400 text-center uppercase mb-2">${lp_points[i]} vs ${alp_points[i]}</p>
                    <div class="grid grid-cols-2 gap-4">
                        <select id="lp_o${i+1}" onchange="vU('lpu${i+1}',this.value)" class="p-3 bg-blue-50 rounded-xl font-black text-xs border-none outline-none">
                            <option value="YES">LP: YES</option><option value="NO">LP: NO</option>
                        </select>
                        <select id="alp_o${i+1}" onchange="vU('alpu${i+1}',this.value)" class="p-3 bg-orange-50 rounded-xl font-black text-xs border-none outline-none">
                            <option value="YES">ALP: YES</option><option value="NO">ALP: NO</option>
                        </select>
                    </div>
                </div>`;
        }

        // 2. Crew Lookup (03 Auto-fills)
        async function lookupCrew(type) {
            const id = document.getElementById(type+'_id').value.toUpperCase();
            try {
                const res = await fetch('https://raw.githubusercontent.com/mukeshrai/cvvrs/main/crew_master.csv');
                const text = await res.text();
                const row = text.split('\n').find(l => l.split(',')[0].trim() === id);
                if(row) {
                    const c = row.split(',');
                    document.getElementById(type+'_info').classList.remove('hidden');
                    document.getElementById(type+'_name_val').innerText = c[1]; // Name/HQ
                    document.getElementById(type+'_dsg_val').innerText = c[2];  // Designation
                    document.getElementById(type+'_cli_val').innerText = c[3];  // Group CLI
                }
            } catch(e) { console.error("CSV Load Error"); }
        }

        // 3. UI Helpers
        function vU(id, val) { /* Mandatory Logic if NO */ }
        function checkAbn(v) { document.getElementById('photo_req').classList.toggle('hidden', !v.trim()); }

        // 4. Final Data Submission
        async function submitToDrive() {
            const btn = document.getElementById('submit_btn');
            btn.innerHTML = "‚è≥ SAVING TO DATA TAB...";
            btn.disabled = true;

            const formData = new URLSearchParams();
            formData.append('cli_name', document.getElementById('cli_name').value);
            formData.append('lp_id', document.getElementById('lp_id').value);
            formData.append('abnormality', document.getElementById('abnormality').value);
            // ... Baaki 32 points bhi isi tarah append honge

            try {
                const response = await fetch(scriptURL, { method: 'POST', body: formData });
                if(response.ok) {
                    btn.classList.add('hidden');
                    document.getElementById('download_btn').classList.remove('hidden');
                    alert("Success! Data in 'Data' tab and folder 'CVVRS_Reports'.");
                }
            } catch(e) {
                alert("Connection Error!");
                btn.disabled = false;
                btn.innerHTML = "RETRY SUBMIT";
            }
        }
    </script>
</body>
</html>
